<div class="row">
	<div class="col-md-12">
		<blockquote class="blockquote">
			<p class="h4 mb-0"><b>Proses Antrian {{layanan}}</b></p>
		</blockquote>
	</div>
</div>
<div class="row">
	<ng2-toasty [position]="'bottom-center'"></ng2-toasty>
	<div class="col-md-12">
		<div class="card mb-3" *ngIf="layanan != 'IGD'">
			<div class="card-header card-info">
				<h4>
					<i class="fa fa-gear" aria-hidden="true"></i> Antrian {{layanan}}
				</h4>
			</div>
			<div class="card-block">
				<div class="card-text">
					<div class="form-group" *ngIf="isfrontoffice">
	                    <label for="kategori">Pilih Kategori Antrian</label>
	                    <div class="input-group">
		                    <select class="form-control" id="kategori" [(ngModel)]="kategori" name="kategori">
		                      <option *ngFor="let kategori of allKategori" [value]="kategori.kategori_antrian">{{kategori.kategori_antrian}}</option>
		                    </select>
		                    <span class="input-group-btn">
		                        <button class="btn btn-secondary" type="button" (click)="setKategori()">Ganti</button>
		                    </span>
	                    </div>
	                </div>
	                <div class="form-group" *ngIf="kategori || !isfrontoffice">
	                    <label for="total">Panjang Antrian Kategori {{selectedKategori}}</label>
	                    <input type="text" class="form-control" id="total" [value]="total" name="total" disabled>
	                </div>
	                <div class="form-group" *ngIf="!antrianEmpty">
		                <label *ngIf="kategori || !isfrontoffice" for="nomor">Antrian yang Dilayani</label>
		                <div class="form-inline">
			                <div class="input-group mb-0 mr-sm-2 mb-sm-0" *ngIf="kategori">
			                  	<input type="text" class="form-control" id="nomor" value="{{selectedKategori}}{{antrian?.no_antrian}} - {{antrian?.nama_pasien}}" name="nomor" disabled>
			              	</div>
			              	<div class="input-group mb-0 mr-sm-2 mb-sm-0" *ngIf="!isfrontoffice">
			                  	<input type="text" class="form-control" id="nomor" value="{{selectedKategori}}{{antrian?.no_antrian}} - {{antrian?.transaksi?.pasien.nama_pasien}}" name="nomor" disabled>
			              	</div>
			              	<div class="input-group mb-0 mr-sm-2 mb-sm-0" *ngIf="kategori || !isfrontoffice">
				              	<div>
					              	<button type="button" class="btn btn-warning mr-2" (click)="proses('undur')">Undur</button>
				              	</div>
				              	<div *ngIf="isfrontoffice">
									<button type="button" class="btn btn-success" [routerLink] = "['/pendaftaran', antrian.nama_layanan]" (click)="proses('proses')">Proses</button>
								</div>
								<div *ngIf="!isfrontoffice && isPoli">
									<button type="button" class="btn btn-success" data-toggle="modal" [attr.data-target]="'#assignDokterModal'" (click)="setRujukan(false)">Proses</button>
								</div>
								<div *ngIf="!isfrontoffice && !isPoli">
									<button type="button" class="btn btn-success" [routerLink] = "['/laboratorium', antrian.nama_layanan, antrian.id_transaksi]" (click)="proses('proses')">Proses</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="card mb-3" *ngIf="!isfrontoffice">
			<div class="card-header card-info">
				<h4 class="mb-0" *ngIf="layanan == 'IGD'">Pasien IGD</h4>
				<h4 class="mb-0" *ngIf="layanan != 'IGD' && layanan.indexOf('Lab ') == -1">Pasien Rujukan</h4>
				<h4 class="mb-0" *ngIf="layanan != 'IGD' && layanan.indexOf('Lab ') != -1">Pasien Rawat Inap</h4>
			</div>
			<div class="card-block">
				<div class="form-group">
					<label for="searchTransaksiRujukan">Cari dengan kode pasien</label>
					<div class="input-group">
						<input type="text" class="form-control" id="searchTransaksiRujukan" [(ngModel)]="searchTransaksiRujukanTerm" (keydown)="onEnter($event)">
						<span class="input-group-btn">
							<button type="button" class="btn btn-success" (click)="searchTransaksiRujukan()">
								Cari
							</button>
						</span>
					</div>
				</div>
				<p *ngFor="let alert of alerts">
					<ngb-alert [type]="alert.type" (close)="closeAlert(alert)">{{ alert.message }}</ngb-alert>
				</p>
				<div *ngIf="transaksiRujukan != null">
					<div class="row">
						<div class="col-md-12">
							<table class="table" [mfData]="transaksiRujukan.allTransaksi" #mf="mfDataTable" [mfRowsOnPage]="rowsOnPage" [(mfSortBy)]="sortBy" [(mfSortOrder)]="sortOrder">
								<thead>
									<th><mfDefaultSorter by="kode_pasien">Kode Pasien</mfDefaultSorter></th>
									<th><mfDefaultSorter by="nama">Nama</mfDefaultSorter></th>
									<th><mfDefaultSorter by="tanggal_lahir">Tanggal Lahir</mfDefaultSorter></th>
									<th><mfDefaultSorter by="alamat">Alamat</mfDefaultSorter></th>
									<th></th>
								</thead>
								<tbody>
									<tr *ngFor="let transaksi of mf.data">
										<td>{{transaksi.pasien.kode_pasien}}</td>
										<td class="text-left">{{transaksi.pasien.nama_pasien}}</td>
										<td>{{transaksi.pasien.tanggal_lahir | date: 'dd-MMM-yyyy'}}</td>
										<td class="text-left">{{transaksi.pasien.alamat}}</td>
										<td>
											<button *ngIf="isPoli" class="btn btn-success" data-toggle="modal" [attr.data-target]="'#assignDokterModal'" (click)="setIdTransaksi(transaksi.id)">
												Proses
											</button>
											<button *ngIf="!isPoli" class="btn btn-success" [routerLink]="['/laboratorium', layanan, transaksi.id]">
												Proses
											</button>
										</td>
									</tr>
								</tbody>
								<tfoot>
									<tr>
										<td colspan="5">
											<mfBootstrapPaginator [rowsOnPageSet]="[5,10,15]"></mfBootstrapPaginator>
										</td>
									</tr>
								</tfoot>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade" tabindex="-1" role="dialog" id="assignDokterModal" aria-hidden="true">
	    <div class="modal-dialog" role="document">
	      <div class="modal-content">

	        <div class="modal-header bg-info text-white">
	          <h5 class="modal-title">Assign Dokter</h5>
	          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	            <i class="fa fa-times" aria-hidden="true"></i>
	          </button>
	        </div>

	        <div class="modal-body">
	          <label for="selectAmbulans">Pilih Dokter</label>
	          <select class="form-control mb-3" id="selectDokter" [(ngModel)]="selectedDokter" name="selectDokter">
	            <option *ngFor="let jadwalDokter of allAvailableDokter" [ngValue]="jadwalDokter">
								{{jadwalDokter.np_dokter}} - {{jadwalDokter.nama_dokter}}
							</option>
	          </select>
	        </div>

	        <div class="modal-footer">
	          <button type="button" class="btn btn-danger" data-dismiss="modal">Batal</button>
	          <button type="button" class="btn btn-success" data-dismiss="modal" (click)="periksa(selectedDokter.np_dokter, layanan, idTransaksi)">Proses</button>
	        </div>

	      </div>
	    </div>
	  </div>
	</div>
</div>
